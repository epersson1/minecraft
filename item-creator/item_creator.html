<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Item Creator</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    .hidden { display: none; }
    label { display: block; margin-top: 1em; }
    textarea { width: 100%; height: 100px; }
    .csv-actions { margin-top: 1em; }
  </style>
</head>
<body>
  <h1>Item Creator</h1>

  <div id="csv-upload">
    <h3>Upload Template CSV</h3>
    <input type="file" id="csvFileInput" accept=".csv" />
    <button id="useSample">Use Sample Data</button>
    <label>Or paste CSV manually:</label>
    <textarea id="csvPaste"></textarea>
    <div class="csv-actions">
      <button id="parseCSV">Load Templates</button>
      <button id="downloadCSV">Download Current CSV</button>
    </div>
  </div>

  <div id="main" class="hidden">
    <label>Name: <input type="text" id="name"></label>
    <label>ID: <input type="text" id="id"></label>
    <label>Data: <input type="text" id="data"></label>
    <label>Display: <input type="text" id="display"></label>
    <label>Lore: <input type="text" id="lore"></label>
    <label>Enchantments: <input type="text" id="enchantments"></label>
    <label>Unbreakable: <input type="checkbox" id="unbreakable"></label>
    <label>Color: <input type="text" id="color"></label>
    <button id="saveItem">Save Item</button>
    <button onclick="location.reload()">Back to Start</button>
  </div>

  <pre id="yamlOutput"></pre>

  <script>
    let templates = [];

    function parseCSVText(csvText) {
      const parsed = Papa.parse(csvText.trim(), { header: true });
      if (parsed.errors.length) {
        alert("CSV Parse Error: " + parsed.errors[0].message);
      } else {
        templates = parsed.data;
        alert("Templates loaded: " + templates.length);
        document.getElementById("main").classList.remove("hidden");
        document.getElementById("csv-upload").classList.add("hidden");
      }
    }

    document.getElementById("csvFileInput").addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => parseCSVText(e.target.result);
        reader.readAsText(file);
      }
    });

    document.getElementById("parseCSV").addEventListener("click", () => {
      const csvText = document.getElementById("csvPaste").value;
      if (csvText) parseCSVText(csvText);
    });

    document.getElementById("useSample").addEventListener("click", () => {
      const sample = `name,id,data,display,lore,enchantments,unbreakable,color\nExample Sword,ex_sword,0,Excalibur,Legendary blade,,true,white`;
      parseCSVText(sample);
    });

    document.getElementById("downloadCSV").addEventListener("click", () => {
      const csv = Papa.unparse(templates);
      const blob = new Blob([csv], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "items_parsed.csv";
      a.click();
    });

    document.getElementById("saveItem").addEventListener("click", () => {
      const item = {
        id: document.getElementById("id").value,
        name: document.getElementById("name").value,
        data: document.getElementById("data").value,
        display: document.getElementById("display").value,
        lore: document.getElementById("lore").value,
        enchantments: document.getElementById("enchantments").value,
        unbreakable: document.getElementById("unbreakable").checked,
        color: document.getElementById("color").value,
      };
      const yaml = jsyaml.dump({ [item.id]: item });
      document.getElementById("yamlOutput").textContent = yaml;
    });
  </script>
</body>
</html>
